<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Freight Calculator</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-50px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(50px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }

    @keyframes shimmer {
      0% {
        background-position: -1000px 0;
      }
      100% {
        background-position: 1000px 0;
      }
    }

    @keyframes goldShine {
      0% {
        background-position: -200% center;
      }
      100% {
        background-position: 200% center;
      }
    }

    .gradient-background {
      background: #000000;
    }

    .gold-shine {
      background: linear-gradient(90deg, #d4af37 0%, #ffd700 25%, #ffed4e 50%, #ffd700 75%, #d4af37 100%);
      background-size: 200% auto;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: goldShine 3s linear infinite;
    }

    .section-divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, #d4af37, transparent);
      margin: 32px 0;
    }

    .animate-fade-in-up {
      animation: fadeInUp 0.6s ease-out;
    }

    .animate-fade-in-down {
      animation: fadeInDown 0.6s ease-out;
    }

    .animate-slide-in-left {
      animation: slideInLeft 0.6s ease-out;
    }

    .animate-slide-in-right {
      animation: slideInRight 0.6s ease-out;
    }

    .animate-pulse {
      animation: pulse 2s ease-in-out infinite;
    }

    .shimmer-effect {
      background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.4), transparent);
      background-size: 1000px 100%;
      animation: shimmer 2s infinite;
    }

    .input-focus-effect {
      transition: all 0.3s ease;
    }

    .input-focus-effect:focus {
      border-bottom-color: #ffd700;
      box-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
    }

    .button-hover {
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .button-hover::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .button-hover:hover::before {
      width: 300px;
      height: 300px;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full">
  <div id="app" class="w-full h-full"></div>
  <script>
    const defaultConfig = {
      background_color: "#000000",
      surface_color: "#1a1a1a",
      text_color: "#ffffff",
      accent_color: "#d4af37",
      button_color: "#ffd700",
      font_family: "Inter",
      font_size: 16,
      page_title: "Freight Calculator",
      page_subtitle: "Calculate your shipping costs instantly",
      distance_label: "Distance (in kilometers)",
      weight_label: "Weight (in tons)",
      additional_info_label: "Additional Information",
      button_text: "Calculate Rate"
    };

    let records = [];

    const dataHandler = {
      onDataChanged(data) {
        records = data;
      }
    };

    function getSuggestedVehicles(weight, distance) {
      let vehicles = [];

      // ---------------------------
      // LIGHT LOADS (0 â€“ 2.5 TON)
      // ---------------------------
      if (weight <= 2.5) {
        if (distance <= 100) {
          vehicles = [
            { name: "TATA ACE", length: "7ft", purpose: "City / Local delivery" },
            { name: "ASHOK LEYLAND DOST", length: "7ft", purpose: "Quick intra-city movement" },
            { name: "BOLERO PICKUP", length: "8ft", purpose: "Light industrial goods" }
          ];
        } else {
          vehicles = [
            { name: "ASHOK LEYLAND BADA DOST", length: "9.5ft", purpose: "Intercity small load" },
            { name: "TATA 407", length: "9ft", purpose: "Better stability for longer distance" }
          ];
        }
      }

      // ---------------------------
      // MEDIUM LOADS (2.6 â€“ 9 TON)
      // ---------------------------
      else if (weight > 2.5 && weight <= 9) {
        if (distance <= 300) {
          vehicles = [
            { name: "EICHER 14 FT", length: "14ft", purpose: "Regional transport" },
            { name: "EICHER 17 FT", length: "17ft", purpose: "Balanced cost & capacity" }
          ];
        } else {
          vehicles = [
            { name: "EICHER 19 FT", length: "19ft", purpose: "Long distance efficiency" },
            { name: "TATA 1109 / 1512", length: "19ft", purpose: "Better mileage on highways" }
          ];
        }
      }

      // ---------------------------
      // HEAVY LOADS (10 â€“ 21 TON)
      // ---------------------------
      else if (weight >= 10 && weight <= 21) {
        if (distance <= 500) {
          vehicles = [
            { name: "TATA TAURUS 6 TYRE", length: "22ft", purpose: "Bulk short-haul movement" }
          ];
        } else {
          vehicles = [
            { name: "TATA TAURUS 10 TYRE", length: "22ft", purpose: "Highway bulk transport" },
            { name: "EICHER 28 FT", length: "28ft", purpose: "Volume + weight optimization" }
          ];
        }
      }

      // ---------------------------
      // VERY HEAVY / SPECIAL LOAD
      // ---------------------------
      else {
        vehicles = [
          { name: "32 FT CONTAINER", length: "32ft", purpose: "High volume freight" },
          { name: "ODC / TRAILER", length: "As Required", purpose: "Over-dimensional cargo" }
        ];
      }

      return vehicles;
    }


    function calculateRate(weight, distance) {
        let ratePerKm;

        // MARKET RATE PER KM (NOT MILEAGE BASED)
        if (weight <= 1) {
            ratePerKm = 21;        // PTL / Pickup
        } else if (weight <= 3) {
            ratePerKm = 26;        // Tata Ace / 407
        } else if (weight <= 7) {
            ratePerKm = 38;        // 14 ft
        } else if (weight <= 12) {
            ratePerKm = 83;        // 22 ft (MATCHES 1,00,000)
        } else {
            ratePerKm = 90;        // Heavy truck
        }

        // MARKET FREIGHT
        let marketFreight = distance * ratePerKm;

        // COST FLOOR (safety)
        let mileage = weight <= 1 ? 17 : weight <= 7 ? 7 : 5;
        let dieselCost = (distance / mileage) * 90;

        let driverCost = distance < 800 ? 3000 : 6000;
        let toll = distance < 800 ? 2500 : 6000;

        let costFloor = dieselCost + driverCost + toll;

        // FINAL RATE = HIGHER OF MARKET OR COST FLOOR
        let finalRate = Math.max(marketFreight, costFloor);

        return {
            ratePerKm,
            dieselCost: Math.round(dieselCost),
            driverCost,
            toll,
            finalRate: Math.round(finalRate)
        };
        }


    async function onConfigChange(config) {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const accentColor = config.accent_color || defaultConfig.accent_color;

      const app = document.getElementById('app');
      app.style.backgroundColor = backgroundColor;
      app.style.fontFamily = `${customFont}, Arial, sans-serif`;
      app.style.color = textColor;

      app.innerHTML = `
        <div class="w-full h-full overflow-auto gradient-background">
          <div class="container mx-auto px-4 py-8 max-w-4xl">
            <!-- HEADER -->
            <header class="text-center mb-8 animate-fade-in-down" style="background: #000000; padding: 32px 24px; border-top: 2px solid ${accentColor}; border-bottom: 2px solid ${accentColor};">
              <div style="margin: 0 auto; max-width: 700px;">
                <h1 class="gold-shine" style="font-size: ${baseSize * 1.5}px; font-weight: 800; letter-spacing: 3px;">AGNIRA LOGISTICS</h1>
                <p style="font-size: ${baseSize * 0.9}px; color: ${textColor}; margin-top: 8px; opacity: 0.9;">Delivering Excellence, Moving Your Business Forward</p>
                <div style="height: 1px; width: 120px; background: linear-gradient(90deg, transparent, ${accentColor}, transparent); margin: 20px auto;"></div>
                <h2 style="font-size: ${baseSize * 1.2}px; color: ${textColor}; font-weight: 600; letter-spacing: 1px; margin-bottom: 8px;">${config.page_title || defaultConfig.page_title}</h2>
                <p style="font-size: ${baseSize * 0.9}px; color: ${accentColor}; font-weight: 500;">${config.page_subtitle || defaultConfig.page_subtitle}</p>
              </div>
            </header>

            <div class="section-divider"></div>

            <!-- CALCULATOR -->
            <main class="animate-fade-in-up" style="padding: 24px;">
              <form id="freight-form">
                <div class="mb-6 animate-slide-in-left" style="animation-delay: 0.1s;">
                  <label for="distance" class="block mb-2" style="font-size: ${baseSize}px; color: ${accentColor}; font-weight: 500;">
                    ${config.distance_label || defaultConfig.distance_label}
                  </label>
                  <input 
                    type="number" 
                    id="distance" 
                    required 
                    step="1"
                    min="1"
                    class="input-focus-effect"
                    style="width: 100%; padding: 12px 0; border: none; border-bottom: 1px solid ${accentColor}; background-color: transparent; color: ${textColor}; font-size: ${baseSize * 1.1}px; outline: none;"
                  />
                </div>

                <div class="mb-6 animate-slide-in-right" style="animation-delay: 0.2s;">
                  <label for="weight" class="block mb-2" style="font-size: ${baseSize}px; color: ${accentColor}; font-weight: 500;">
                    ${config.weight_label || defaultConfig.weight_label}
                  </label>
                  <input 
                    type="number" 
                    id="weight" 
                    required 
                    step="0.1"
                    min="0.1"
                    class="input-focus-effect"
                    style="width: 100%; padding: 12px 0; border: none; border-bottom: 1px solid ${accentColor}; background-color: transparent; color: ${textColor}; font-size: ${baseSize * 1.1}px; outline: none;"
                  />
                </div>

                <div class="mb-6 animate-slide-in-left" style="animation-delay: 0.3s;">
                  <label for="additional-info" class="block mb-2" style="font-size: ${baseSize}px; color: ${accentColor}; font-weight: 500;">
                    ${config.additional_info_label || defaultConfig.additional_info_label}
                  </label>
                  <textarea 
                    id="additional-info" 
                    rows="3"
                    class="input-focus-effect"
                    style="width: 100%; padding: 12px 0; border: none; border-bottom: 1px solid ${accentColor}; background-color: transparent; color: ${textColor}; font-size: ${baseSize * 1.1}px; resize: none; outline: none;"
                  ></textarea>
                </div>

                <button 
                  type="submit" 
                  id="submit-btn"
                  class="button-hover animate-pulse"
                  style="width: 100%; padding: 16px; background: linear-gradient(90deg, #d4af37, #ffd700, #d4af37); color: #000000; font-size: ${baseSize * 1.2}px; font-weight: 900; border: none; cursor: pointer; letter-spacing: 2px; box-shadow: 0 4px 20px rgba(212, 175, 55, 0.5); margin-top: 24px;"
                >
                  ${config.button_text || defaultConfig.button_text}
                </button>
              </form>

              <!-- Contact -->
              <div class="animate-fade-in-up" style="margin-top: 32px; padding-top: 24px; border-top: 1px solid ${accentColor}; text-align: center;">
                <p style="font-size: ${baseSize * 0.85}px; color: ${textColor}; margin-bottom: 12px; opacity: 0.7;">24/7 Support Available</p>
                <div style="display: flex; justify-content: center; gap: 24px; flex-wrap: wrap;">
                  <a href="tel:8757589370" style="color: ${accentColor}; text-decoration: none; font-weight: 700; font-size: ${baseSize}px;">ðŸ“ž 8757589370</a>
                  <a href="tel:8401264256" style="color: ${accentColor}; text-decoration: none; font-weight: 700; font-size: ${baseSize}px;">ðŸ“± 8401264256</a>
                </div>
              </div>

              <!-- Results -->
              <div id="result" style="display: none; margin-top: 32px; padding-top: 32px; border-top: 2px solid ${accentColor};">
                <h2 class="animate-fade-in-down" style="font-size: ${baseSize * 1.3}px; color: ${accentColor}; font-weight: 600; margin-bottom: 20px; letter-spacing: 1px;">RESULTS</h2>
                
                <div style="margin-bottom: 24px;">
                  <h3 style="font-size: ${baseSize}px; color: ${accentColor}; font-weight: 500; margin-bottom: 12px;">Suggested Vehicles</h3>
                  <div id="vehicles-list"></div>
                </div>

                <div style="border-top: 1px solid ${accentColor}; padding-top: 20px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <span style="font-size: ${baseSize * 1.1}px; font-weight: 600; color: ${accentColor};">Estimated Rate</span>
                    <span id="final-rate" class="animate-pulse" style="font-size: ${baseSize * 1.8}px; font-weight: 900; color: ${accentColor};"></span>
                  </div>
                  <p style="font-size: ${baseSize * 0.8}px; color: ${textColor}; opacity: 0.7; line-height: 1.5;">
                    System-generated estimate. Contact us for confirmed rates.
                  </p>
                </div>
              </div>
            </main>

            <div class="section-divider"></div>

            <!-- Footer -->
            <footer class="animate-fade-in-up" style="text-align: center; padding: 24px;">
              <h3 class="gold-shine" style="font-size: ${baseSize * 1.2}px; font-weight: 800; letter-spacing: 2px;">AGNIRA LOGISTICS</h3>
              <div style="height: 1px; width: 80px; background: linear-gradient(90deg, transparent, ${accentColor}, transparent); margin: 12px auto;"></div>
              <p style="font-size: ${baseSize * 0.7}px; color: ${accentColor}; opacity: 0.6;">Â© 2024 Agnira Logistics. All rights reserved.</p>
            </footer>
          </div>
        </div>
      `;

      setupFormHandler(config);
    }

    function setupFormHandler(config) {
      const form = document.getElementById('freight-form');
      const submitBtn = document.getElementById('submit-btn');
      const resultDiv = document.getElementById('result');
      const accentColor = config.accent_color || defaultConfig.accent_color;
      const baseSize = config.font_size || defaultConfig.font_size;
      const textColor = config.text_color || defaultConfig.text_color;

      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        if (records.length >= 999) {
          showNotification('Maximum limit reached. Contact support.', '#d32f2f', baseSize);
          return;
        }

        const distance = parseFloat(document.getElementById('distance').value);
        const weight = parseFloat(document.getElementById('weight').value);
        const additionalInfo = document.getElementById('additional-info').value;

        submitBtn.disabled = true;
        submitBtn.innerHTML = '<div class="shimmer-effect" style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">Calculating...</div>';
        submitBtn.style.opacity = '0.7';

        try {
          await new Promise(resolve => setTimeout(resolve, 600));

          const vehicles = getSuggestedVehicles(weight , distance);
          const costs = calculateRate(weight, distance);

          const vehiclesList = document.getElementById('vehicles-list');
          vehiclesList.innerHTML = vehicles.map((v, index) => `
            <div class="animate-slide-in-right"
                style="animation-delay: ${index * 0.05}s;
                        border-left: 2px solid ${accentColor};
                        padding: 10px 0 10px 14px;
                        margin-bottom: 10px;">

              <div style="font-weight: 700;
                          font-size: ${baseSize * 0.95}px;
                          color: ${textColor};">
                ${v.name}
              </div>

              <div style="color: ${accentColor};
                          font-size: ${baseSize * 0.8}px;
                          opacity: 0.85;">
                Length: ${v.length}
              </div>

              <div style="margin-top: 4px;
                          font-size: ${baseSize * 0.8}px;
                          color: ${textColor};
                          opacity: 0.7;">
                ${v.purpose}
              </div>
            </div>
          `).join('');

          document.getElementById('final-rate').textContent = `â‚¹${costs.finalRate}`;
          resultDiv.style.display = 'block';

          const record = {
            id: Date.now().toString(),
            distance: distance,
            weight: weight,
            suggested_vehicle: vehicles[0].name,
            vehicle_length: vehicles[0].length,
            final_rate: costs.finalRate,
            additional_info: additionalInfo,
            created_at: new Date().toISOString()
          };

          const result = await window.dataSdk.create(record);
          if (!result.isOk) {
            showNotification('Failed to save. Try again.', '#d32f2f', baseSize);
          } else {
            showNotification('Calculation saved!', '#4caf50', baseSize);
          }

        } catch (error) {
          showNotification('Error occurred. Try again.', '#d32f2f', baseSize);
        } finally {
          submitBtn.disabled = false;
          submitBtn.innerHTML = config.button_text || defaultConfig.button_text;
          submitBtn.style.opacity = '1';
        }
      });
    }

    function showNotification(message, bgColor, fontSize) {
      const notification = document.createElement('div');
      notification.textContent = message;
      notification.className = 'animate-fade-in-down';
      notification.style.cssText = `position: fixed; top: 20px; right: 20px; background-color: ${bgColor}; color: white; padding: 12px 20px; border-radius: 6px; z-index: 1000; font-size: ${fontSize * 0.9}px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);`;
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 3000);
    }

    async function init() {
        if (window.dataSdk) {
            const initResult = await window.dataSdk.init(dataHandler);
            if (!initResult.isOk) {
            console.error('Failed to initialize data SDK');
            }
        }

        if (window.elementSdk) {
            await window.elementSdk.init({
            defaultConfig,
            onConfigChange,
            mapToCapabilities: () => ({}),
            mapToEditPanelValues: () => new Map()
            });

            await onConfigChange(window.elementSdk.config);
        } else {
            // ðŸ”¥ FALLBACK FOR NORMAL BROWSER
            console.warn("elementSdk not found, loading default UI");
            await onConfigChange(defaultConfig);
        }
        }


    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9adc544061ce3b7f',t:'MTc2NTcwMDkyMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>